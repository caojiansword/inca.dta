<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">

<head>
<title th:text="#{导出}"></title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta charset="UTF-8" />
<script th:src="@{/js/jquery-1.11.1.js}" type="text/javascript"></script>
<script th:src="@{/js/miniui.js}" type="text/javascript" charset="utf-8"></script>
<script th:src="@{/js/MiniuiMessageBox.js}" type="text/javascript" charset="utf-8"></script>
<script th:inline="javascript">
	//<![CDATA[
	$(document).ready(function(){
		$("form.output-form").submit(function(event) {
			doDataoutputBtn();
			return false;
		});
	});
	
	function doDataoutputBtn() {
	    var fd = new FormData(document.getElementById("output-form"));
	    fd.append("label", "WEBUPLOAD");
	    var url = /*[[@{{funcPath}/export(funcPath=${funcPath})}]]*/;
	    $.ajax({
	      url: url,
	      type: "POST",
	      data: fd,
	      enctype: 'multipart/form-data',
	      processData: false,  // tell jQuery not to process the data
	      contentType: false   // tell jQuery not to set contentType
	    }).done(function(data) {
	    	$("#imp_msg").html("导出结束！");
	    	// 导出成功
	    	debugger;
	    	if (data.code==1000) {
	    		$("#imp-msg-textarea").html("导出完成！" + data.result);
	    	} else {
	    		$("#imp-msg-textarea").html(data.message);
	    	}
	    });
	    
	    $("#imp_msg").html("导出文件正在处理中...");
	}
	function showRealPath(filePath){
		debugger;
		$("#exportfileRealPath").val(filePath);
	}
	//]]>
</script>

</head>
<body>
   <div class="modal-dialog" id="output-dialog" style="higth:300px">
      <div class="modal-content">
         <div class="modal-header">
            <h3 class="modal-title" id="myModalLabel">
               	导出文件
            </h3>
         </div>
         <div class="modal-body">
			<form name="output-form" id="output-form" method="POST"  enctype="multipart/form-data" 
			 class="output-form" target = "imp_hidden_frame">
			 <div class="form-group">
				 <div class = "col-lg-6">
				     <input type="hidden" name="exportfileRealPath" id = "exportfileRealPath">
					 <input type="file" id="file" name="file"  accept=".xls,.xlsx" onchange="showRealPath(this.value);"/>
				 </div>
			 </div>
			 
			 <br/>
			 <div class = "form-group" >
			 	<div class = "col-lg-12">
			 		<label th:text="${msg}" ></label>
			 	</div>
			 </div>
			 <div class = "form-group" >
			 	<div class = "col-lg-12">
			 		<span th:text="${imp_msg}" id = "imp_msg" style = "color:red" ></span>
			 	</div>
			 </div>
			 <div class="form-group">
				 <div class = "col-lg-12">
				 	<input  class="btn btn-primary" type="submit" value="导出"/><br/>
				 </div>
			 </div>
			 
			<br>
			<div class="form-group">
				<div class="row">
					<div class="col-lg-4">
						<label class="col-lg-3" th:text="导出完成信息"></label>
					</div>
        		 	<textarea rows="10" cols="95" id="imp-msg-textarea" readonly="readonly">
        			</textarea> 
				</div>
			</div>
			 
			 
			</form>
			<!-- 隐藏的提交导出frame -->
			<iframe name="imp_hidden_frame" id="imp_hidden_frame" style="display:none"></iframe> 
        
         </div>
         
      </div>
   </div>
</body>
</html>